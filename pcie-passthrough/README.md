# üõ†Ô∏è fix_vfio_dupplicates.sh

–°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤ —É —Ñ–∞–π–ª—ñ **`/etc/modprobe.d/vfio.conf`**.  
–î–æ–ø–æ–º–∞–≥–∞—î —É –≤–∏–ø–∞–¥–∫–∞—Ö, –∫–æ–ª–∏ [—É—Ç–∏–ª—ñ—Ç–∞](https://github.com/Danilop95/Proxmox-Enhanced-Configuration-Utility) –¥–æ–¥–∞—î –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω—ñ `vfio-pci ids` –∑–∞–ø–∏—Å–∏, —â–æ –∑–∞–≤–∞–∂–∞—î –∫–æ—Ä–µ–∫—Ç–Ω–æ–º—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—é –º–æ–¥—É–ª—ñ–≤ VFIO.

## ‚öôÔ∏è –Ø–∫ –ø—Ä–∞—Ü—é—î
- üìÇ –°—Ç–≤–æ—Ä—é—î —Ä–µ–∑–µ—Ä–≤–Ω—É –∫–æ–ø—ñ—é —Ñ–∞–π–ª—É `vfio.conf`
- üîç –ó–Ω–∞—Ö–æ–¥–∏—Ç—å —É—Å—ñ `ids=` –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
- ‚úÇÔ∏è –ù–æ—Ä–º–∞–ª—ñ–∑—É—î —Ä–µ–≥—ñ—Å—Ç—Ä, –ø—Ä–∏–±–∏—Ä–∞—î –¥—É–±–ª—ñ–∫–∞—Ç–∏
- ‚úèÔ∏è –ü–µ—Ä–µ–∑–∞–ø–∏—Å—É—î —Ä—è–¥–æ–∫ –∑ —á–∏—Å—Ç–∏–º —Å–ø–∏—Å–∫–æ–º –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤

## üöÄ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

1. ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç—ñ—Ç—å –≤ –∫–æ–Ω—Å–æ–ª—ñ Proxmox:

```bash
bash <(curl -sL https://raw.githubusercontent.com/ravado/homeserver/refs/heads/main/pcie-passthrough/fix_vfio_dupplicates.sh)
```

2. üîÑ –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ö–æ—Å—Ç:

```bash
reboot
```

3. ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –º–æ–¥—É–ª—ñ VFIO –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –±–µ–∑ –ø–æ–º–∏–ª–æ–∫:

```bash
dmesg | grep vfio
```

–ú–∞—î—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —â–æ—Å—å —Ç–∞–∫–µ:

```bash
vfio-pci 0000:0b:00.0: enabling device
vfio-pci 0000:0b:00.0: bound to vfio-pci
```

–ì–æ–ª–æ–≤–Ω–µ ‚Äî —â–æ–± –±—É–≤ –∑–∞–ø–∏—Å bound to vfio-pci, —Ü–µ –æ–∑–Ω–∞—á–∞—î —â–æ –ø—Ä–∏—Å—Ç—Ä—ñ–π —É—Å–ø—ñ—à–Ω–æ –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∏–π –¥–æ VFIO.
–Ø–∫—â–æ –±–∞—á–∏—Ç–µ failed to bind –∞–±–æ –≤–∑–∞–≥–∞–ª—ñ –Ω–µ–º–∞—î —Ä—è–¥–∫—ñ–≤ –∑ vfio-pci ‚Äî —â–æ—Å—å —â–µ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É—î –∑ –¥—Ä–∞–π–≤–µ—Ä–æ–º.